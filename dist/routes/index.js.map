{"version":3,"sources":["../../src/routes/index.js"],"names":["router","Router","get","req","res","next","render","title","docId","query","id","post","json","success","token","jwt","action","redirect"],"mappings":";;;;;;AAAA;;;;AAEA;;;;AACA;;AACA;;AACA;;;;;;AAJA,IAAMA,SAAS,kBAAQC,MAAR,EAAf;;;AAMAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACvCD,MAAIE,MAAJ,CAAW,OAAX,EAAoB;AAClBC,WAAO,SADW;AAElBC,WAAOL,IAAIM,KAAJ,CAAUC,EAFC,CAEE;AAFF,GAApB;AAID,CALD;;AAOA;AACAV,OAAOW,IAAP,CAAY,YAAZ,0BACe;AACb,UAASR,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACvBD,MAAIQ,IAAJ,CAAS;AACPC,aAAS,IADF;AAEPC,WAAOX,IAAIY,GAFJ;AAGPC,YAAQ;AAHD,GAAT;AAKD,CARH;;AAWA;AACA;AACAhB,OAAOW,IAAP,CAAY,YAAZ,yBACc;AADd,8BAEkB;AAFlB,mBAGa;AAHb,+BAImB;AAJnB,0BAKoB;AAClB,UAASR,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACvBD,MAAIa,QAAJ,CAAa,GAAb;AACD,CARH;;kBAWejB,M","file":"index.js","sourcesContent":["import express from 'express';\nconst router = express.Router();\nimport checkUrls from '../middleware/crawler.js';\nimport {prepareToCrawl, processPageData} from '../middleware/sheets-helper.js';\nimport {createToken, checkToken} from '../middleware/jwt-helper.js';\nimport sendNotification from '../middleware/postmark-helper.js';\n\nrouter.get('/', function(req, res, next) {\n  res.render('index', {\n    title: 'Express',\n    docId: req.query.id // Auto-fill text input with 'id' URL parameter\n  });\n});\n\n// Start by creating a Javascript Web Tokein (JWT) and sending it to client\nrouter.post('/api/token',\n  createToken, // Creates JWT\n  function(req, res, next) {\n    res.json({\n      success: true,\n      token: req.jwt,\n      action: 'crawl'\n    });\n  }\n);\n\n// With success above, proceed to crawl website(s), record info\n// in Google Sheets, then send e-mail notification if there's new info\nrouter.post('/api/crawl',\n  checkToken, // Verifies JWT\n  prepareToCrawl, // Reads existing info from Google Sheets\n  checkUrls, // Crawls website(s)\n  processPageData, // Writes new info to Google Sheets\n  sendNotification, // Sends e-mail notification\n  function(req, res, next) {\n    res.redirect('/');\n  }\n);\n\nexport default router;\n"]}